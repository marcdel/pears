name: Check if app.pears.dev is up

on:
  schedule:
    - cron: '0 * * * *'

jobs:
  health_check:
    runs-on: ubuntu-latest
    permissions:
      issues: write
      pull-requests: write

    steps:
      - name: URL Health Check
        uses: Jtalk/url-health-check-action@v3.1
        with:
          url: https://app.pears.dev/
          follow-redirect: false
          max-attempts: 3
          retry-delay: 5s
  slack_notification:
    name: Slack Notification
    runs-on: ubuntu-latest
    if: failure()
    steps:
      - name: Slack Notification
        uses: rtCamp/action-slack-notify@v2
        env:
          SLACK_CHANNEL: general
          SLACK_COLOR: ${{ job.status }}
          SLACK_TITLE: app.pears.dev is down!
          SLACK_MESSAGE: 'app.pears.dev is down! scale it back up here: https://console.gigalixir.com/#/apps/pears'
          SLACK_WEBHOOK: ${{ secrets.SLACK_WEBHOOK }}